# Интернет-магазин

Проект интернет-магазина с поддержкой множества поставщиков, асинхронной обработкой задач и контейнеризацией.

## Содержание

- [Функциональность](#функциональность)
- [Технологии](#технологии)
- [Архитектура](#архитектура)
- [Установка и запуск](#установка-и-запуск)
- [API документация](#api-документация)
- [Тестирование](#тестирование)
- [Структура проекта](#структура-проекта)

## Функциональность

- **Пользователи и аутентификация**
  - Регистрация и авторизация пользователей
  - Роли: клиенты и поставщики
  - Аутентификация через токены

- **Каталог товаров**
  - Просмотр товаров с фильтрацией и поиском
  - Категории товаров
  - Детальная информация о товаре

- **Корзина и заказы**
  - Добавление товаров в корзину
  - Оформление заказа
  - История заказов
  - Отмена заказов

- **Функционал для поставщиков**
  - Управление товарами (добавление, редактирование, удаление)
  - Импорт/экспорт товаров в YAML формате
  - Просмотр заказов с товарами поставщика

- **Асинхронные задачи**
  - Отправка email-уведомлений
  - Импорт товаров

## Технологии

- **Backend**: Django, Django REST Framework
- **Асинхронные задачи**: Celery, Redis
- **База данных**: PostgreSQL
- **Контейнеризация**: Docker, Docker Compose
- **Тестирование**: pytest, factory-boy
- **Веб-сервер**: Nginx, Gunicorn

## Архитектура

Проект построен на основе Django с использованием REST API для взаимодействия с фронтендом. Архитектура включает следующие компоненты:

1. **Django + DRF**: Основной бэкенд, обрабатывающий HTTP-запросы
2. **PostgreSQL**: Реляционная база данных для хранения данных
3. **Redis**: Брокер сообщений для Celery и кэширование
4. **Celery**: Обработка асинхронных задач (отправка email, импорт товаров)
5. **Nginx**: Веб-сервер для обслуживания статических файлов и проксирования запросов
6. **Gunicorn**: WSGI-сервер для запуска Django-приложения

## Установка и запуск

### Предварительные требования

- Docker
- Docker Compose

### Шаги для запуска

1. **Клонирование репозитория**

```bash
git clone <url-репозитория>
cd myproject
```

2. **Настройка переменных окружения**

```bash
cp .env.example .env
```

Отредактируйте файл `.env` и укажите необходимые параметры.

3. **Сборка и запуск контейнеров**

```bash
./start.sh
```

или вручную:

```bash
docker-compose up -d
```

4. **Создание суперпользователя**

```bash
docker-compose exec web python manage.py createsuperuser
```

5. **Доступ к приложению**

- Веб-приложение: http://localhost:80
- Админ-панель: http://localhost:80/admin

### Управление контейнерами

- **Остановка контейнеров**

```bash
docker-compose down
```

- **Просмотр логов**

```bash
docker-compose logs -f
```

- **Выполнение команд внутри контейнера**

```bash
docker-compose exec web python manage.py <команда>
```

## API документация

### Аутентификация

#### Регистрация

```
POST /api/register/
```

Параметры:
- `username`: Имя пользователя
- `email`: Email
- `password`: Пароль
- `password2`: Подтверждение пароля
- `first_name`: Имя
- `last_name`: Фамилия
- `phone`: Телефон
- `address`: Адрес
- `user_type`: Тип пользователя (`customer` или `supplier`)
- `company_name`: Название компании (только для поставщиков)

#### Вход

```
POST /api/login/
```

Параметры:
- `email`: Email
- `password`: Пароль

### Товары

#### Получение списка товаров

```
GET /api/products/
```

Параметры фильтрации:
- `category`: ID категории
- `search`: Поисковый запрос
- `ordering`: Сортировка (`price`, `-price`, `name`)

#### Получение информации о товаре

```
GET /api/products/{id}/
```

### Корзина

#### Получение корзины

```
GET /api/cart/
```

#### Добавление товара в корзину

```
POST /api/cart/
```

Параметры:
- `product`: ID товара
- `quantity`: Количество

#### Изменение количества товара в корзине

```
POST /api/cart/update_quantity/
```

Параметры:
- `product`: ID товара
- `quantity`: Новое количество

#### Удаление товара из корзины

```
POST /api/cart/remove_product/
```

Параметры:
- `product`: ID товара

### Заказы

#### Оформление заказа

```
POST /api/order-confirmation/confirm/
```

Параметры:
- `delivery_address_id`: ID адреса доставки
- `cart_id`: ID корзины (опционально)

#### Получение списка заказов

```
GET /api/orders/
```

#### Получение информации о заказе

```
GET /api/orders/{id}/
```

#### Отмена заказа

```
POST /api/orders/{id}/cancel/
```

### API для поставщиков

#### Получение списка своих товаров

```
GET /api/supplier/products/
```

#### Добавление нового товара

```
POST /api/supplier/products/
```

Параметры:
- `name`: Название товара
- `description`: Описание
- `price`: Цена
- `category`: ID категории
- `stock`: Количество на складе
- `is_active`: Активен ли товар
- `characteristics`: JSON с характеристиками товара

#### Обновление товара

```
PUT /api/supplier/products/{id}/
```

#### Удаление товара

```
DELETE /api/supplier/products/{id}/
```

#### Экспорт товаров

```
GET /api/supplier/products/export_products/
```

#### Импорт товаров

```
POST /api/supplier/products/import_products/
```

## Тестирование

Проект покрыт автоматическими тестами с использованием pytest. Для запуска тестов выполните:

```bash
./run_tests.sh
```

или

```bash
pytest --cov=shop --cov-report=term-missing --cov-report=html
```

Отчет о покрытии кода тестами будет доступен в директории `htmlcov/`.

Для запуска тестов в Docker:

```bash
docker-compose run tests
```

## Структура проекта

- `myproject/` - основной проект Django
- `shop/` - приложение интернет-магазина
  - `models.py` - модели данных
  - `views.py` - представления API
  - `serializers.py` - сериализаторы для API
  - `tasks.py` - задачи Celery
  - `utils.py` - вспомогательные функции
  - `admin.py` - настройки админ-панели
  - `tests/` - тесты
- `nginx/` - конфигурация Nginx
- `Dockerfile` - инструкции для сборки контейнера Django
- `Dockerfile.celery` - инструкции для сборки контейнера Celery
- `docker-compose.yml` - конфигурация Docker Compose
- `requirements.txt` - зависимости Python